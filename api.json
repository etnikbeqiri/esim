{
    "openapi": "3.1.0",
    "info": {
        "title": "eSIM API Documentation",
        "version": "1.0.0",
        "description": "# eSIM API Documentation\n\nWelcome to the eSIM API. This API allows B2B partners to integrate eSIM purchasing into their applications.\n\n## Authentication\n\nAll authenticated endpoints require a Bearer token in the Authorization header:\n```\nAuthorization: Bearer YOUR_API_TOKEN\n```\n\n## Base URL\nAll API endpoints are prefixed with `/api/v1`\n\n## Rate Limiting\nAPI requests are rate limited. Please contact support for details on your rate limits."
    },
    "servers": [
        {
            "url": "http://localhost:8000/api/v1"
        }
    ],
    "paths": {
        "/health": {
            "get": {
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "status": {
                                            "type": "string",
                                            "enum": [
                                                "ok"
                                            ]
                                        },
                                        "timestamp": {
                                            "type": "string"
                                        }
                                    },
                                    "required": [
                                        "status",
                                        "timestamp"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        },
        "/b2b/balance": {
            "get": {
                "operationId": "balance.show",
                "description": "Returns the current balance information for the authenticated B2B account.\nIncludes total balance, reserved amount, and available balance.",
                "summary": "Get balance",
                "tags": [
                    "B2B Balance",
                    "Balance"
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        200
                                    ]
                                }
                            }
                        }
                    },
                    "401": {
                        "$ref": "#/components/responses/AuthenticationException"
                    }
                }
            }
        },
        "/b2b/balance/transactions": {
            "get": {
                "operationId": "balance.transactions",
                "description": "Returns a paginated list of balance transactions for the authenticated B2B account.\nTransactions include top-ups, reservations, deductions, and refunds.",
                "summary": "List balance transactions",
                "tags": [
                    "B2B Balance",
                    "Balance"
                ],
                "parameters": [
                    {
                        "name": "per_page",
                        "in": "query",
                        "schema": {
                            "type": "string",
                            "default": 20
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        200
                                    ]
                                }
                            }
                        }
                    },
                    "401": {
                        "$ref": "#/components/responses/AuthenticationException"
                    }
                }
            }
        },
        "/b2b/orders": {
            "post": {
                "operationId": "b2BOrder.store",
                "description": "Creates a new order using B2B account balance. The order is processed immediately\nand the eSIM will be provisioned automatically. Balance is deducted upon order creation.",
                "summary": "Create B2B order",
                "tags": [
                    "B2B Orders",
                    "B2BOrder"
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "package_id": {
                                        "type": "integer"
                                    }
                                },
                                "required": [
                                    "package_id"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        201
                                    ]
                                }
                            }
                        }
                    },
                    "422": {
                        "$ref": "#/components/responses/ValidationException"
                    },
                    "401": {
                        "$ref": "#/components/responses/AuthenticationException"
                    }
                }
            }
        },
        "/checkout": {
            "post": {
                "operationId": "checkout.store",
                "description": "Creates a checkout session for purchasing an eSIM package.\n\nFor **B2B customers**: Payment is deducted from balance immediately.\nThe response includes `instant_payment: true` and the order starts processing.\n\nFor **B2C customers**: A payment gateway URL is returned.\nRedirect the user to complete payment, then poll the verify endpoint.",
                "summary": "Create checkout session",
                "tags": [
                    "Checkout"
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "package_id": {
                                        "type": "integer"
                                    },
                                    "success_url": {
                                        "type": "string",
                                        "format": "uri"
                                    },
                                    "cancel_url": {
                                        "type": "string",
                                        "format": "uri"
                                    },
                                    "fail_url": {
                                        "type": [
                                            "string",
                                            "null"
                                        ],
                                        "format": "uri"
                                    },
                                    "language": {
                                        "type": [
                                            "string",
                                            "null"
                                        ],
                                        "enum": [
                                            "en",
                                            "de",
                                            "fr",
                                            "it"
                                        ]
                                    }
                                },
                                "required": [
                                    "package_id",
                                    "success_url",
                                    "cancel_url"
                                ]
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        201
                                    ]
                                }
                            }
                        }
                    },
                    "422": {
                        "$ref": "#/components/responses/ValidationException"
                    },
                    "401": {
                        "$ref": "#/components/responses/AuthenticationException"
                    }
                }
            }
        },
        "/checkout/{orderUuid}/verify": {
            "get": {
                "operationId": "checkout.verify",
                "description": "Verifies the checkout status and confirms if payment was successful.\nUse this endpoint to poll for payment completion after redirecting\nfrom the payment gateway.",
                "summary": "Verify checkout",
                "tags": [
                    "Checkout"
                ],
                "parameters": [
                    {
                        "name": "orderUuid",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        200
                                    ]
                                }
                            }
                        }
                    },
                    "401": {
                        "$ref": "#/components/responses/AuthenticationException"
                    }
                }
            }
        },
        "/checkout/{orderUuid}/status": {
            "get": {
                "operationId": "checkout.status",
                "description": "Returns the current status of a checkout/order for polling purposes.\nUse this to display order progress to the user.",
                "summary": "Get checkout status",
                "tags": [
                    "Checkout"
                ],
                "parameters": [
                    {
                        "name": "orderUuid",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        200
                                    ]
                                }
                            }
                        }
                    },
                    "401": {
                        "$ref": "#/components/responses/AuthenticationException"
                    }
                }
            }
        },
        "/countries": {
            "get": {
                "operationId": "country.index",
                "description": "Returns a list of all active countries with available eSIM packages.\nCountries are sorted with popular ones first, then alphabetically.",
                "summary": "List all countries",
                "tags": [
                    "Countries",
                    "Country"
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        200
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        },
        "/countries/popular": {
            "get": {
                "operationId": "country.popular",
                "description": "Returns a list of popular countries that have available eSIM packages.\nUseful for featuring popular destinations on landing pages.",
                "summary": "Get popular countries",
                "tags": [
                    "Countries",
                    "Country"
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        200
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        },
        "/countries/regions": {
            "get": {
                "operationId": "country.regions",
                "description": "Returns a list of all distinct regions that have active countries.\nUseful for building region-based navigation or filters.",
                "summary": "Get all regions",
                "tags": [
                    "Countries",
                    "Country"
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "object",
                                    "properties": {
                                        "data": {
                                            "type": "array",
                                            "items": {
                                                "type": "string"
                                            }
                                        }
                                    },
                                    "required": [
                                        "data"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        },
        "/orders": {
            "get": {
                "operationId": "order.index",
                "description": "Returns a paginated list of orders for the authenticated user.\nOrders are sorted by creation date, newest first.",
                "summary": "List orders",
                "tags": [
                    "Orders",
                    "Order"
                ],
                "parameters": [
                    {
                        "name": "per_page",
                        "in": "query",
                        "schema": {
                            "type": "string",
                            "default": 20
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        200
                                    ]
                                }
                            }
                        }
                    },
                    "401": {
                        "$ref": "#/components/responses/AuthenticationException"
                    }
                }
            }
        },
        "/orders/{order}": {
            "get": {
                "operationId": "order.show",
                "description": "Returns detailed information about a specific order including\npackage details, payment history, and eSIM profile if available.",
                "summary": "Get order details",
                "tags": [
                    "Orders",
                    "Order"
                ],
                "parameters": [
                    {
                        "name": "order",
                        "in": "path",
                        "required": true,
                        "description": "The order UUID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        200
                                    ]
                                }
                            }
                        }
                    },
                    "404": {
                        "$ref": "#/components/responses/ModelNotFoundException"
                    },
                    "401": {
                        "$ref": "#/components/responses/AuthenticationException"
                    }
                }
            }
        },
        "/orders/{order}/esim": {
            "get": {
                "operationId": "order.esimDetails",
                "description": "Returns the eSIM activation details for a completed order including\nICCID, activation code, QR code data, and data usage information.",
                "summary": "Get eSIM details",
                "tags": [
                    "Orders",
                    "Order"
                ],
                "parameters": [
                    {
                        "name": "order",
                        "in": "path",
                        "required": true,
                        "description": "The order UUID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        200
                                    ]
                                }
                            }
                        }
                    },
                    "404": {
                        "$ref": "#/components/responses/ModelNotFoundException"
                    },
                    "401": {
                        "$ref": "#/components/responses/AuthenticationException"
                    }
                }
            }
        },
        "/orders/{order}/cancel": {
            "post": {
                "operationId": "order.cancel",
                "description": "Cancels an order if it's in a cancellable state (pending or awaiting payment).\nFor B2B orders, the reserved balance will be refunded.",
                "summary": "Cancel order",
                "tags": [
                    "Orders",
                    "Order"
                ],
                "parameters": [
                    {
                        "name": "order",
                        "in": "path",
                        "required": true,
                        "description": "The order UUID",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "requestBody": {
                    "content": {
                        "application/json": {
                            "schema": {
                                "type": "object",
                                "properties": {
                                    "reason": {
                                        "type": "string",
                                        "default": "Cancelled by customer"
                                    }
                                }
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        200
                                    ]
                                }
                            }
                        }
                    },
                    "404": {
                        "$ref": "#/components/responses/ModelNotFoundException"
                    },
                    "401": {
                        "$ref": "#/components/responses/AuthenticationException"
                    }
                }
            }
        },
        "/packages": {
            "get": {
                "operationId": "package.index",
                "description": "Returns a paginated list of all available eSIM packages. Supports filtering by country,\ndata amount, price range, and features like popular or featured packages.",
                "summary": "List all packages",
                "tags": [
                    "Packages",
                    "Package"
                ],
                "parameters": [
                    {
                        "name": "sort_by",
                        "in": "query",
                        "description": "Sorting",
                        "schema": {
                            "type": "string",
                            "default": "retail_price"
                        }
                    },
                    {
                        "name": "sort_dir",
                        "in": "query",
                        "schema": {
                            "type": "string",
                            "default": "asc"
                        }
                    },
                    {
                        "name": "per_page",
                        "in": "query",
                        "schema": {
                            "type": "string",
                            "default": 20
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        200
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        },
        "/packages/popular": {
            "get": {
                "operationId": "package.popular",
                "description": "Returns up to 12 popular eSIM packages, sorted by price ascending.\nUseful for featuring on homepage or landing pages.",
                "summary": "Get popular packages",
                "tags": [
                    "Packages",
                    "Package"
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        200
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        },
        "/packages/{package}": {
            "get": {
                "operationId": "package.show",
                "description": "Returns detailed information about a specific eSIM package including\ncountry information, provider details, and coverage data.",
                "summary": "Get package details",
                "tags": [
                    "Packages",
                    "Package"
                ],
                "parameters": [
                    {
                        "name": "package",
                        "in": "path",
                        "required": true,
                        "description": "The package ID",
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        200
                                    ]
                                }
                            }
                        }
                    },
                    "404": {
                        "$ref": "#/components/responses/ModelNotFoundException"
                    }
                }
            }
        },
        "/countries/{country}/packages": {
            "get": {
                "operationId": "package.byCountry",
                "description": "Returns all available eSIM packages for a specific country,\nsorted by data amount and then by price.",
                "summary": "Get packages by country",
                "tags": [
                    "Packages",
                    "Package"
                ],
                "parameters": [
                    {
                        "name": "country",
                        "in": "path",
                        "required": true,
                        "description": "The country ID",
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "integer",
                                    "enum": [
                                        200
                                    ]
                                }
                            }
                        }
                    },
                    "404": {
                        "$ref": "#/components/responses/ModelNotFoundException"
                    }
                }
            }
        },
        "/webhooks/payrexx": {
            "post": {
                "operationId": "webhooks.payrexx",
                "summary": "Handle Payrexx webhook",
                "tags": [
                    "PayrexxWebhook"
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "anyOf": [
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "success"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "status"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "already_processed"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "status"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "failed"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "status"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "cancelled"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "status"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "refunded"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "status"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "acknowledged"
                                                    ]
                                                },
                                                "event": {
                                                    "type": "string"
                                                }
                                            },
                                            "required": [
                                                "status",
                                                "event"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "ignored"
                                                    ]
                                                },
                                                "reason": {
                                                    "type": "string",
                                                    "enum": [
                                                        "payment_not_found"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "status",
                                                "reason"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "ignored"
                                                    ]
                                                },
                                                "reason": {
                                                    "type": "string",
                                                    "enum": [
                                                        "order_not_found"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "status",
                                                "reason"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "ignored"
                                                    ]
                                                },
                                                "reason": {
                                                    "type": "string",
                                                    "enum": [
                                                        "missing_reference"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "status",
                                                "reason"
                                            ]
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        },
        "/webhooks/stripe": {
            "post": {
                "operationId": "webhooks.stripe",
                "summary": "Handle Stripe webhook",
                "tags": [
                    "StripeWebhook"
                ],
                "responses": {
                    "200": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "anyOf": [
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "acknowledged"
                                                    ]
                                                },
                                                "event": {
                                                    "type": [
                                                        "string",
                                                        "null"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "status",
                                                "event"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "expired"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "status"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "already_processed"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "status"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "ignored"
                                                    ]
                                                },
                                                "reason": {
                                                    "type": "string",
                                                    "enum": [
                                                        "order_not_found"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "status",
                                                "reason"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "ignored"
                                                    ]
                                                },
                                                "reason": {
                                                    "type": "string",
                                                    "enum": [
                                                        "missing_reference"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "status",
                                                "reason"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "success"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "status"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "status": {
                                                    "type": "string",
                                                    "enum": [
                                                        "ignored"
                                                    ]
                                                },
                                                "reason": {
                                                    "type": "string",
                                                    "enum": [
                                                        "payment_not_found"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "status",
                                                "reason"
                                            ]
                                        }
                                    ]
                                }
                            }
                        }
                    },
                    "400": {
                        "description": "",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "anyOf": [
                                        {
                                            "type": "object",
                                            "properties": {
                                                "error": {
                                                    "type": "string",
                                                    "enum": [
                                                        "Invalid payload"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "error"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "error": {
                                                    "type": "string",
                                                    "enum": [
                                                        "Invalid signature"
                                                    ]
                                                }
                                            },
                                            "required": [
                                                "error"
                                            ]
                                        }
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    "components": {
        "responses": {
            "ModelNotFoundException": {
                "description": "Not found",
                "content": {
                    "application/json": {
                        "schema": {
                            "type": "object",
                            "properties": {
                                "message": {
                                    "type": "string",
                                    "description": "Error overview."
                                }
                            },
                            "required": [
                                "message"
                            ]
                        }
                    }
                }
            },
            "ValidationException": {
                "description": "Validation error",
                "content": {
                    "application/json": {
                        "schema": {
                            "type": "object",
                            "properties": {
                                "message": {
                                    "type": "string",
                                    "description": "Errors overview."
                                },
                                "errors": {
                                    "type": "object",
                                    "description": "A detailed description of each field that failed validation.",
                                    "additionalProperties": {
                                        "type": "array",
                                        "items": {
                                            "type": "string"
                                        }
                                    }
                                }
                            },
                            "required": [
                                "message",
                                "errors"
                            ]
                        }
                    }
                }
            },
            "AuthenticationException": {
                "description": "Unauthenticated",
                "content": {
                    "application/json": {
                        "schema": {
                            "type": "object",
                            "properties": {
                                "message": {
                                    "type": "string",
                                    "description": "Error overview."
                                }
                            },
                            "required": [
                                "message"
                            ]
                        }
                    }
                }
            }
        }
    }
}